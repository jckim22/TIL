
# 🐔패킷화
- SRC의 네트워크 계층 패킷의 페이로드는 캡슐화
- DST의 네트워크 계층 패킷으로부터는 페이로드가 역캡슐화 된다.
>🐤페이로드를 발신지에서 목적지까지 어떤 변경없이 전달하기 위함이다.

# 🐔라우팅과 포워딩
- 라우팅 / Routing
🐤 발신지에서 목적지까지 패킷이 네트워크 상에 잘 전달될 수 있도록 경로를 라우팅 함

- 포워딩 / Forwarding
🐤라우터 상의 입력 인터페이스로 패킷이 도착했을 때 라우팅 테이블을 보고 출력 인터페이스를 찾는 것

>🐣 라우팅과 포워딩은 거의 같은 의미로 생각하자

# 🐔패킷 스위칭
- 네트워크에서 패킷 교환이 일어나는 것을 패킷 스위칭이라고 함
- 발신지에서 메시지는 데이터그램 단위 즉, 작은 단위로 나누어 전송됨
- 수신된 데이터그램은 목적지에서 원래의 메시지로 재조립
- 제공되는 서비스는 비연결형 서비스와, 연결 지향 서비스가 있음

# 🐔데이터 그램 방식: 비연결 서비스
- 각 패킷을 상호독립적으로 처리하며, 네트워크내의 교환기를 라우터라고 함
- 라우터는 목적지 주소(IP)를 기반으로 패킷을 전달

# 🐔가상 회선 방식 : 연결 지향형 서비스
- 서비스 제공을 위해 설정, 데이터 전송, 연결해제 과정 사용
- 데이터그램 송신 전에 경로를 지정하는 가상회선(Virtual circuit) 생성
- 연결 생성 후 같은 경로를 따라 데이터그램을 전달, 패킷에는 가상회선 식별자가 있어야 함
- 패킷은 레이블을 기반으로 포워딩 -> 포워딩 결정은 레이블의 값 혹은 가상 회선 식별자에 의해 결정

> 🐣  데이터그램 방식: 패킷 간에 독립성을 갖고 경로가 유동적
🐣  가상 회선 방식: 연결 설정을 통해 신뢰성 있고 순서가 유지되는 전용 경로를 사용


# 🐔 주소 공간
- IPv4와 같은 프로토콜은 주소 공간을 갖는 주소들을 정의
- 프로토콜에서 사용되는 주소들의 전체 수를 의미한다.
- IP 주소 공간
🐤(n + (32-n)) bits 이다.
🐤여기서 n은 prefix이고 32-n은 suffix이다.
🐤32인 이유는 IPv4가 32비트의 수로 이루어져있기 때문(1byte x 4)
>prefix : 네트워크를 식별하는데 사용
suffix: 호스트를 식별하는데 사용

- EX)
 ISP가 80.70.56.0/21 블록을 갖고 있다.
ISP는 2개의 기관에 각각 500개, 다른 2개의 기관에 각각 250개, 그리고 3개의 기관에 각각 50개의 주소들을 할당해 주길 원한다.

- ISP가 갖는 전체 블록의 주소들의 개수와 범위는 ?
>21이 prefix이므로 suffix는 32-21=11이다.
따라서 2^11개의 범위의 호스트를 갖게 될 것이다.
2^11은 2048이므로 2048개의 주소를 갖게 될 것이다.
>>시작 주소는 80.70.56.0/21이고
>>80.70.56.255/21 (256개, 합 256)
>>80.70.57.255/21 (256개, 합 512 )
>>80.70.58.255/21 (256개, 합 768)
>>80.70.59.255/21 (256개, 합 1024)
>>80.70.60.255/21 (256개, 합 1280)
>>80.70.61.255/21 (256개, 합 1536)
>>80.70.62.255/21 (256개, 합 1792)
>>80.70.63.255/21 (256개, 합 2048) 로 끝 주소는 80.70.63.255/21 이다.

- 주소를 할당 받은 각 기관들의 주소 범위와 할당되지 않은 주소 범위를 찾아라
>- 500개를 할당 받은 기관 2개
>>- 500보다 다음으로 큰 2의 제곱은 2^9=512이다.
>>- 따라서 suffix는 9이고 prefix는 23이다.
>>- 80.70.56.255/23 (256개 합 256)
>>- 80.70.57.255/23 (256개 합 512)
>>- 80.70.58.255/23 (256개 합 768)
>>- 80.70.59.255/23 (256개 합 1024) 이다.
>- 250개를 할당 받은 기관 2개
>> - 250보다 다음으로 큰 2의 제곱은 2^8=256이다
>>- 80.70.60.255/24 (256개 합 256)
>>- 80.70.61.255/24 (256개 합 512) 이다.
>- 50개를 할당 받은 기관 3개
>>- 50보다 큰 2의 제곱은 2^6=64이다.
>>- 80.70.62.63/26 (64개 합 64)
>>- 80.70.62.127/26 (64개 합 128)
>>- 80.70.62.191/26 (64개 합 192) 이다.

- 할당 되지 않은 주소 범위
> 나머지인 80.70.62.192 ~ 80.70.63.255 이다.


- 45000054 00030000 2006.... 과 같은 헤더의 정보가 도착했다.
- 헤더의 크기, 데이터의 크기, 얼마나 많은 홉을 지날 수 있는지 ?
> - 처음의 4는 버전 정보 그 다음의 5가 헤더렝스 이다.
>- 헤더 렝스는 항상 4를 곱해줘야 하는 프로토콜이 있다.
>- 따라서 헤더의 진짜 길이는 20바이트이다.
> - 데이터의 크기
> - 데이터의 크기는 Total Length로 0054에 이다.
> - 16진수인 데이터 54는 이진수로 0101 0100 이므로 84이다.
> - TTL은 18바이트번째 이다.
> - 20이 TTL이고 이는 0010 0000 이므로 10진수로는 32이다.
> - 따라서 32개의 홉을 더 지날 수 있다.

# 🐔서브넷팅/Subneting
  - 블록을 작은 블록으로 나누는 개념 (위에서 사용한 바로 다음 거듭제곱을 할당하는 방식)
  
  
# 🐔DHCP
- Dynamic Host Configuration Protocol의 약어로, 동적 호스트 구성 프로토콜이다.
- DHCP는 클라이언트-서버 패러다임을 사용하는 응용계층 프로그램이다.
- 네트워크 계층의 TCP/IP 보조
- 동적으로 호스트에 주소를 할당할 때 사용하며 임시 IP 주소를 제한된 시간동안 제공 가능하다.

# 🐔NAT
- Network Address Translation의 약어, 사설 주소와 범용 주소 사이에 매핑을 제공해주는 기술
- 한 사이트에서 내부 통신을 위해 사설 주소들을 사용하고,
- 다른 네트워크와의 통신에는 범용 주소들을 사용할 수 있도록 도와줌

- 사설 주소
>  - 내부적으로만 사용하는 IP로, 사설 용도를 위해 할당
> - 전역 네트워크에서 인식되지 않음
> - 네트워크가 분리되어 있거나 NAT를 사용하여 사설 네트워크를 인터넷에 연결하는데 사용

- 동작 과정
>1. NAT Router는 변환 테이블에 출발지 주소와 도착지 주소를 작성
>2. 사설 주소를 외부와 통신이 가능한 공인 IP로 변환
>3. 패킷을 수신한 웹 서버는 사용자에게 응답을 보내며, 출발지 주소와 도착지 주소가 변경
됨.
>4. 응답 패킷을 수신한 NAT 장비는 변환 테이블을 기준으로 도착지 주소를 변경

# 🐔IP
- IP에서 사용되는 패킷 : 데이타그램
🐤 IPv4 데이타그램 형식
- 데이터 그램은 가변 길이의 패킷으로 두 부분으로 구성
>헤더 / header & 페이로드 / payload
 헤더 길이는 20에서 60 byte이고, 라우팅과 전달에 필수적인 정보를 포함하고 있음
헤더 길이 / HLEN → 4비트
20 바이트~60 바이트, 4 비트의 값으로 헤더의 전체 길이를 4바이트 단위 표시
선택 사항 없이 20바이트일 경우, HLEN = 5 ( * 4 = 20 )
선택 사항 포함 60바이트일 경우, HLEN = 15 ( * 4 = 20 )
전체 길이 / Total Length → 16비트
65,535까지 표현
IP 데이터그램의 전체 길이를 바이트 단위로 표시
데이터 길이 = 전체 길이 - 헤더 길이 (HLEN * 4)

- 첫 8비트가 인 IPv4 패킷이 수신, 폐기되었음. 이유는 ?
> 첫 4비트는 버전을 의미 → 올바름
> 다음 4비트 헤더의 길이 → → 헤더의 최소 바이트 수는 20 이므로 전송 중 변
형된 패킷로 판명

- IPv4 패킷에서 HLEN의 값이 이면, 이 패킷의 옵션은 몇 바이트?
> 가 기본 헤더이므로, 옵션은
IPv4 패킷에서, HLEN의 값이 5이고 전체 길이의 값이

- 이 패킷은 몇 바이트의 데이타들을 포함?
> 
 전체 길이 , HLEN = 이므로, 이 패킷은 20 바이트의 데이터를 전송 중
첫 몇 바이트의 16진수 값이 다음과 같은 IPv4이 도착

-  이 패킷이 폐기되기 전까지 몇 홉(노드)를 통과할 수 있는가?

-  이 패킷의 데이터는 어떤 상위 프로토콜에 포함?
>1칸이 4bit를 의미
TTL을 확인해야하는 상황 → 64bit 즉, 8byte 이후 8bit의 해당 부분이 TTL
에 해당
즉, 하나의 홉만 지나갈 수 있다는 의미
프로토콜 필드는 다음 바이트 에 해당하므로, 상위 계층 프로토콜이 IGMP라는
것을 의미

- 단편화 / Fragmentation
> 큰 크기의 프레임이 작은 크기의 프레임으로 바뀌어 전송되어야 할 경우 단편화가 수행됨
(01000010)2
2 × 4 = 8
(1000)2
8 × 4 = 32byte 20byte 12 byte
(0028)16
(0028)16 = 16 × 2 + 8 = 40
40 byte 20 byte
(45000028000100000102...)16
(01)16
(02)16

- IPv4 헤더 옵션
>Single-byte
No operation / 무연산 옵션
End of option / 옵션 종료 옵션
Multiple-byte
Record route / 경로 기록 옵션
Strict source route / 엄격한 발신지 경로 옵션
Loose source route / 느슨한 발신지 경로 옵션
Timestamp / 타임스탬프 옵션


# 🐔ICMPv4
- IPv4 프로토콜에는 오류 보고나 오류 수정 기능이 없음
- IP 프로토콜에는 호스트와 관리를 위한 질의 메커니즘도 없음
> ICMP는 이러한 두 가지 단점을 보완하기 위해 등장

- ICMP 메시지들은 크게 두 가지 형태로 나뉨
>1. 오류 보고 메시지 / error-reporting messages
→ 라우터나 목적지 호스트가 IP 패킷을 처리할 때 발생하는 문제점들을 보고
>2. 질의 메시지 / query messages
→ 쌍으로 생성(req / res), 다른 호스트로부터 특정 정보를 획득하기 위해 사용됨

- 오류 보고 메시지의 중요한 사항
>1. ICMP 오류 메시지를 전달하는 데이터그램 에 대해서는 ICMP 오류 메시지가 생성되지
않음
>2. 첫 번째 단편이 아닌 단편화된 데이터그램 에 대해서는 ICMP 오류 메시지가 생성되지
않음
>3. 멀티캐스트 주소를 가진 데이터그램 에 대해서는 ICMP 오류 메시지가 생성되지 않음
>4. 127.0.0.0이나 0.0.0.0과 같은 특별한 주소를 가진 데이터그램 에 대해서는 오류 메시지
가 생성되지 않음

- 오류 보고 메시지 / Error-reporting

🐤목적지 도달 불가 / Destination-unreachable
> - 라우터가 데이터그램을 라우팅할 수 없거나 호스트에게 데이터그램을 배달할 수 없을 때
데이터그램은 폐기
> - 발신지 호스트에 목적지 도달 불가 메시지 전달

🐤발신지-억제 / Source-quench
>- IP 프로토콜은 흐름-제어, 혼잡-제어 메커니즘이 없음
→ 혼잡으로 인하여 데이터그램 폐기를 발신지에 알림

🐤시간 경과 메시지 / Time-exceeded
>- 라우터가 TTL 필드를 감소해 값이 0 이 되면 데이터그램을 폐기하고 시간 경과 메시지를
원래 발신지에게 보냄
- 최종 목적지가 정해진 시간 내에 모든 단편을 받지 못했으면 이미 수신된 단편은 폐기
- 이후 원래의 발신지로 시간 경과 메시지를 보냄

🐤매개변수 문제 메시지 / Parameter-problem
>- 데이터그램 헤더에 불명확한 점이 있으면 문제 발생
- 라우터나 목적지 호스트에 의해 생성될 수 있음

🐤재지정 메시지 / Redirection
>- 재지정 메시지는 라우터로 부터 같은 네트워크에 있는 호스트로 전달됨
→ 다른 네트워크로 가는 라우팅 패킷을 잘못 받았을 때 올바른 라우터에게 재전송


- 질의 메시지 / Query
🐤 - 네트워크 문제를 진단하기 위해 질의 메시지 사용

🐤에코 요청과 응답 / Echo Request and Reply
>- 라우터나 호스트가 통신할 수 있는지 점검
→ IP 프로토콜의 동작을 검사하기 위하여 사용할 수 있음 : ping

🐤 타임스템프 요청과 응답 / Timestamp Request and Reply
>- 호스트나 라우터를 지나가는데 필요한 왕복시간 round-trip time 또는 시계 동기화에 사용

🐤 최소 비용 라우팅 / Least-Cost Routing
>- 가중치 그래프로 모델링 시, 발신지 라우터로 부터 목적지 라우터까지의 최선의 경로로 설
정하는 한 가지 방법
→ 둘 사이에 최소 비용 을 찾는 것
: 발신지 라우터가 목적지 라우터로의 경로를 선택할 때, 
 모든 가능한 경로들 중 전체 비용이 가장 최소 비용인 경로를 선택하는 것 ~ 일반적인 아이디어

🐤최소 비용 트리 / Least Cost Tree

# 🐔 라우팅 알고리즘
🐤거리 벡터 알고리즘
>말 그대로 거리, 거리만 보고 경로를 만드는 알고리즘
대표적으로 RIP가 있음 (현재는 사용 x) -> 벨만포드 사용


🐤링크 상태 알고리즘
>가중치가 까지 계산해서 경로를 만드는 알고리즘
대표적으로 OSRF가 있음 -> 다익스트라 사용

🐤경로 벡터 알고리즘
>가중치가 있어도 어떤 일이 일어날지 모름
그래서 최소가 아닌 최선의 경로를 유동적으로 찾는 알고리즘
대표적으로 BFP가 있음 -> 스패닝 트리 기반
-> 유일한 도메인 간 라우팅 -> 경로 벡터 알고리즘에 기반하고 있음
각 자율 시스템(AS)간 하나의 대표 노드 (Speaker node)가 BFP 통신을 진행
 -> AS는 메트릭(맵 정보)을 통지하는 것이 아닌, 경로(path)만 통지

🐤내부(Internal)와 외부(Externbal) BFP 세션
>- 세션 = Connection
- 내부 BGP 세션 = AS 내부의 경로에 대한 정보 구분
- 외부 BFP 세션 = Speaker 노드들 간의 경로 공유
- Stub AS : 가입자/ 네트워크가 붙음
- Transparent AS : 백본 개념 -> Point to Point 연결

>- 각 AS내 모든 라우터에 RIP(거리) or OSRF(링크) 설치, iBGP를 모든 라우터에 설치
-각 AS의 경계 라유터(Speaker Router)에 eBGP 설치


# 🐔 멀티캐스트 IP 주소 변환
- IP 주소가  232.43.14.7이다.
- IP 주소의 오른쪽 23비트(그룹 주소)를 16진수로 바꾼다.
- 그 뒤 앞에 이더넷 멀티캐스트 시작 주소인 01:00:5E:00:00:00을 추가한다.

# 🐔 멀티캐스트 라우팅
- 발신지 기반 트리 (source-based trees)
🐤MOSRF
🐤DVMRP
🐤PIM-DM (밀집)
- 그룹 공유 트리 (group-shared trees)
🐤PIM-SM (성간)
🐤CBT
